\hypertarget{_2_users_2dbin_2work_2fastensor_2examples_2ft_example_vector_2d_8cpp-example}{}\doxysection{/\+Users/dbin/work/fastensor/examples/ft\+\_\+example\+\_\+vector\+\_\+2d.\+cpp}
This example show how to output a vector in Fas\+Tensor . ~\newline
 \begin{DoxyAuthor}{Author}
Bin Dong (\href{mailto:dbin@lbl.gov}{\texttt{ dbin@lbl.\+gov}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2021-\/05-\/28
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2021
\end{DoxyCopyright}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{comment}{/*}}
\DoxyCodeLine{\textcolor{comment}{****************************}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{FasTensor (FT) Copyright (c) 2021, The Regents of the University of}}
\DoxyCodeLine{\textcolor{comment}{California, through Lawrence Berkeley National Laboratory (subject to}}
\DoxyCodeLine{\textcolor{comment}{receipt of any required approvals from the U.S. Dept. of Energy). }}
\DoxyCodeLine{\textcolor{comment}{All rights reserved.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{If you have questions about your rights to use or distribute this software,}}
\DoxyCodeLine{\textcolor{comment}{please contact Berkeley Lab's Intellectual Property Office at}}
\DoxyCodeLine{\textcolor{comment}{IPO@lbl.gov.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{NOTICE.  This Software was developed under funding from the U.S. Department}}
\DoxyCodeLine{\textcolor{comment}{of Energy and the U.S. Government consequently retains certain rights.  As}}
\DoxyCodeLine{\textcolor{comment}{such, the U.S. Government has been granted for itself and others acting on}}
\DoxyCodeLine{\textcolor{comment}{its behalf a paid-\/up, nonexclusive, irrevocable, worldwide license in the}}
\DoxyCodeLine{\textcolor{comment}{Software to reproduce, distribute copies to the public, prepare derivative }}
\DoxyCodeLine{\textcolor{comment}{works, and perform publicly and display publicly, and to permit others to do so.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{****************************}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{*** License Agreement ***}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{FasTensor (FT) Copyright (c) 2021, The Regents of the University of}}
\DoxyCodeLine{\textcolor{comment}{California, through Lawrence Berkeley National Laboratory (subject to}}
\DoxyCodeLine{\textcolor{comment}{receipt of any required approvals from the U.S. Dept. of Energy). }}
\DoxyCodeLine{\textcolor{comment}{All rights reserved.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{Redistribution and use in source and binary forms, with or without}}
\DoxyCodeLine{\textcolor{comment}{modification, are permitted provided that the following conditions are met:}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{(1) Redistributions of source code must retain the above copyright notice,}}
\DoxyCodeLine{\textcolor{comment}{this list of conditions and the following disclaimer.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{(2) Redistributions in binary form must reproduce the above copyright}}
\DoxyCodeLine{\textcolor{comment}{notice, this list of conditions and the following disclaimer in the}}
\DoxyCodeLine{\textcolor{comment}{documentation and/or other materials provided with the distribution.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{(3) Neither the name of the University of California, Lawrence Berkeley}}
\DoxyCodeLine{\textcolor{comment}{National Laboratory, U.S. Dept. of Energy nor the names of its contributors}}
\DoxyCodeLine{\textcolor{comment}{may be used to endorse or promote products derived from this software}}
\DoxyCodeLine{\textcolor{comment}{without specific prior written permission.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "{}AS IS"{}}}
\DoxyCodeLine{\textcolor{comment}{AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE}}
\DoxyCodeLine{\textcolor{comment}{IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE}}
\DoxyCodeLine{\textcolor{comment}{ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE}}
\DoxyCodeLine{\textcolor{comment}{LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR}}
\DoxyCodeLine{\textcolor{comment}{CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF}}
\DoxyCodeLine{\textcolor{comment}{SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS}}
\DoxyCodeLine{\textcolor{comment}{INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN}}
\DoxyCodeLine{\textcolor{comment}{CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)}}
\DoxyCodeLine{\textcolor{comment}{ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE}}
\DoxyCodeLine{\textcolor{comment}{POSSIBILITY OF SUCH DAMAGE.}}
\DoxyCodeLine{\textcolor{comment}{}}
\DoxyCodeLine{\textcolor{comment}{You are under no obligation whatsoever to provide any bug fixes, patches,}}
\DoxyCodeLine{\textcolor{comment}{or upgrades to the features, functionality or performance of the source}}
\DoxyCodeLine{\textcolor{comment}{code ("{}Enhancements"{}) to anyone; however, if you choose to make your}}
\DoxyCodeLine{\textcolor{comment}{Enhancements available either publicly, or directly to Lawrence Berkeley}}
\DoxyCodeLine{\textcolor{comment}{National Laboratory, without imposing a separate written license agreement}}
\DoxyCodeLine{\textcolor{comment}{for such Enhancements, then you hereby grant the following license: a}}
\DoxyCodeLine{\textcolor{comment}{non-\/exclusive, royalty-\/free perpetual license to install, use, modify,}}
\DoxyCodeLine{\textcolor{comment}{prepare derivative works, incorporate into other computer software,}}
\DoxyCodeLine{\textcolor{comment}{distribute, and sublicense such enhancements or derivative works thereof,}}
\DoxyCodeLine{\textcolor{comment}{in binary and source code form.}}
\DoxyCodeLine{\textcolor{comment}{*/}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <stdarg.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{ft_8h}{ft.h}}"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{\textcolor{keyword}{using namespace }\mbox{\hyperlink{namespace_f_t}{FT}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Chunk size}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define INPUT\_CHK\_ROWS 4}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define INPUT\_CHK\_COLS 4}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//Size of the output vector per chunk}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define OUTPUT\_VEC\_ROWS 2}}
\DoxyCodeLine{\textcolor{preprocessor}{\#define OUTPUT\_VEC\_COLS 2}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{inline} \mbox{\hyperlink{class_stencil}{Stencil<std::vector<float>}}> \mbox{\hyperlink{ft__example__vector__2d_8cpp_ad42b12e6fe64674510874a6316cde8e0}{udf\_vector\_2d}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_stencil}{Stencil<float>}} \&iStencil)}
\DoxyCodeLine{\{}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{class_stencil}{Stencil<std::vector<float>}}> oStencil;}
\DoxyCodeLine{    std::vector<float> temp\_vec(\mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}} * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}});}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//each output element is sum of a OUTPUT\_VEC\_ROWS by OUTPUT\_VEC\_COLS}}
\DoxyCodeLine{    \textcolor{comment}{//e.g. input 4 by 4 chunks is}}
\DoxyCodeLine{    \textcolor{comment}{//      A[0][0] A[0][1] A[0][2] A[0][3]}}
\DoxyCodeLine{    \textcolor{comment}{//      A[1][0] A[1][1] A[1][2] A[1][3]}}
\DoxyCodeLine{    \textcolor{comment}{//      A[2][0] A[2][1] A[2][2] A[2][3]}}
\DoxyCodeLine{    \textcolor{comment}{//      A[3][0] A[3][1] A[3][2] A[3][3]}}
\DoxyCodeLine{    \textcolor{comment}{//}}
\DoxyCodeLine{    \textcolor{comment}{// The output B is}}
\DoxyCodeLine{    \textcolor{comment}{//      B[0][0] =  A[0][0] +  A[0][1] + A[1][0] + A[1][1]}}
\DoxyCodeLine{    \textcolor{comment}{//      B[0][1] =  A[0][2] +  A[0][3] + A[1][2] + A[1][3]}}
\DoxyCodeLine{    \textcolor{comment}{//      .....}}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}}; i++)}
\DoxyCodeLine{    \{}
\DoxyCodeLine{        \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}}; j++)}
\DoxyCodeLine{        \{}
\DoxyCodeLine{            temp\_vec[i * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}} + j] = iStencil(i * \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}}, j * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}}) + iStencil(i * \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}}, j * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}} + 1) + iStencil(i * \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}} + 1, j * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}}) + iStencil(i * \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}} + 1, j * \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}} + 1);}
\DoxyCodeLine{        \}}
\DoxyCodeLine{    \}}
\DoxyCodeLine{    oStencil = temp\_vec;}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{ft__utility_8h_a3bb8c3c86721391778ec4ce4ca4969ed}{PrintVector}}(\textcolor{stringliteral}{"{}temp\_vec = "{}}, temp\_vec);}
\DoxyCodeLine{    std::vector<size\_t> vector\_shape(2);}
\DoxyCodeLine{    vector\_shape[0] = \mbox{\hyperlink{ft__example__vector__2d_8cpp_a33635e866ede16f5e8bd43550d9998b8}{OUTPUT\_VEC\_ROWS}};}
\DoxyCodeLine{    vector\_shape[1] = \mbox{\hyperlink{ft__example__vector__2d_8cpp_aa3c314d116f0b7a284e087081e54eb89}{OUTPUT\_VEC\_COLS}};}
\DoxyCodeLine{    oStencil.\mbox{\hyperlink{class_stencil_a03b873b1884e5e0e866d62f0a8829235}{SetShape}}(vector\_shape);}
\DoxyCodeLine{    \textcolor{keywordflow}{return} oStencil;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} \mbox{\hyperlink{au__example__1f1p_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{comment}{//Init the MPICH, etc.}}
\DoxyCodeLine{    \mbox{\hyperlink{ft_8h_a431d3e09d3b2d6ce2bb5944af7e73ee7}{AU\_Init}}(argc, argv);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// set up the chunk size and the overlap size}}
\DoxyCodeLine{    std::vector<int> chunk\_size = \{4, 4\};}
\DoxyCodeLine{    std::vector<int> overlap\_size = \{0, 0\};}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Orginal data set}}
\DoxyCodeLine{    Array<float> *A = \textcolor{keyword}{new} Array<float>(\textcolor{stringliteral}{"{}EP\_HDF5:./test-\/data/testf-\/16x16-\/vector-\/2d.h5:/testg/testd"{}}, chunk\_size, overlap\_size);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Results data to be stored in a file}}
\DoxyCodeLine{    Array<float> *B = \textcolor{keyword}{new} Array<float>(\textcolor{stringliteral}{"{}EP\_HDF5:./test-\/data/testf-\/16x16-\/vector-\/2d-\/output.h5:/testg/testd"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Set the direction to flat vector of output}}
\DoxyCodeLine{    \textcolor{comment}{//A-\/>SetVectorDirection(AU\_FLAT\_OUTPUT\_ROW);}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Skip paramter, run the udf\_vector on the first cell of each 4 by 4 chunk}}
\DoxyCodeLine{    std::vector<int> skip\_size = \{4, 4\};}
\DoxyCodeLine{    A-\/>EnableApplyStride(skip\_size);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Run udf\_vector}}
\DoxyCodeLine{    A-\/>Apply(\mbox{\hyperlink{ft__example__vector__2d_8cpp_ad42b12e6fe64674510874a6316cde8e0}{udf\_vector\_2d}}, B);}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//std::vector<float> AV = A-\/>ReadArray(std::vector<unsigned long long> (0,0), std::vector<unsigned long long> (16,16));}}
\DoxyCodeLine{    \textcolor{comment}{//std::vector<float> BV = B-\/>ReadArray();}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{//Clear}}
\DoxyCodeLine{    \textcolor{keyword}{delete} A;}
\DoxyCodeLine{    \textcolor{keyword}{delete} B;}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{ft_8h_a52987d19f550018ced56aa710d9979b4}{AU\_Finalize}}();}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}

\end{DoxyCodeInclude}
 